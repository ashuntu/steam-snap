#!/usr/bin/python3

import json
import os

NVIDIA_ENV = "__NV_PRIME_RENDER_OFFLOAD=1 __GLX_VENDOR_LIBRARY_NAME=nvidia __VK_LAYER_NV_optimus=NVIDIA_only"

def main():
    lshw = os.popen("lshw -json -numeric -c display 2> /dev/null").read()
    gpus = json.loads(lshw)
    env_string = ""

    for gpu in gpus:
        pci = gpu["businfo"]\
            .replace("@", "-")\
            .replace(":", "_")\
            .replace(".", "_")

        if "nvidia" in gpu["vendor"].lower():
            env_string = f"DRI_PRIME={pci} {NVIDIA_ENV} "
            break

        elif "amd" in gpu["vendor"].lower():
            env_string = f"DRI_PRIME={pci} "
            break

    print(env_string)


if __name__ == "__main__":
    main()
